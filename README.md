# MikrotikBackup
## Скрипт резервного копирования настроек и журнала устройства с автоопределением расположения хранилища

  Имею в хозяйстве разношёрстные устройства Mikrotik, каждое из которых обладает своими особенностями хранения данных: где-то используется внешний USB-накопитель, где-то встроенный flash-диск устройства. На некоторых устройствах встроенный диск по умолчанию называется 'flash', а на других никак не называется :)
  
  Захотелось изобразить один универсальный бэкап-скрипт, который одинаково хорошо сохранит все настройки и журналы любого из этих устройств на доступном в текущий момент накопителе.
  
  Скрипт необходимо запустить на устройстве, а далее он сам разберётся что, как и куда нужно сохранять...
По умолчанию в настройках скрипта задана глубина архива =180 дней, которая автоматически снижается при нехватке свободного места на доступном накопителе.
Попутно, при запуске скрипта в окне терминала можно наблюдать отчёт о его работе.

Алгоритм работы скрипта:
 - определяется место для хранения данных. Приоритеты в порядке убывания: 1. внешний накопитель, 2. встроенный накопитель
 - генерится новое имя для файлов: 'Путь/ИмяРоутера_Текущая-Дата_Текущее-Время'
 - удаляются все файлы, **старше глубины архива** и подходящие под шаблон: 'Путь/ИмяРоутера_'
 - в случае, когда на накопителе осталось менее 4% свободного места: удаляются файлы **младше глубины архива** и подходящие под шаблон: 'Путь/ИмяРоутера_'
 - создаются и сохраняются следующие файлы на накопителе:
   - настройки устройства в формате '.backup'
   - конфигурация устройства в формате '.rsc'
   - журнал устройства в формате '.txt'
   - конфигурация 'The Dude' в формате '.rsc'
   - база данных 'The Dude' в формате '.db'

  В скрипте имеется возможность ручной настройки пути к каталогу, где хранятся бэкапы. Для этого в настройках скрипта следует отключить автоопределение места хранения бэкапов путём присвоения переменной 'autoDskSel' значения 'false' и указания полного пути к целевому каталогу через символы "/" в переменной 'backupPath'.
  
  **Обратите внимание, это важно!!!** В файловой системе маршрутизатора необходимо **ЗАРАНЕЕ ВРУЧНУЮ** создать каталог, куда скрипт будет сохранять бэкапы. Пользователи Windows могут это сделать путём создания папки в Проводнике и перетаскивания её в нужное место в окно Files в Winbox.

Типовая настройка периода запуска скрипта по расписанию - один раз в сутки.

https://forummikrotik.ru/viewtopic.php?p=91135#p91135

Features:
- automatically determines the data storage location,
- allows you to set the archive depth in days,
- looks after free space on the drive,
- saves backup file, settings file, log file, base and settings "The Dude",
- file names is based on the device ID, date and time,
- works on RouterOS 6.xx and 7.xx
- no dependencies on other software modules

**Используете скрипт - отметьте это звездочкой, Вам не сложно, а мне приятно!**
