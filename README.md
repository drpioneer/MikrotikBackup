# MikrotikBackup
## Сценарий резервного копирования настроек и журнала устройства с автоматическим определением местоположения хранилища

  Имею в хозяйстве разношёрстные устройства Mikrotik и каждое из них обладает своими особенностями хранения данных: где-то используется внешний USB-накопитель, где-то встроенный flash-диск устройства. На части устройств встроенный диск по умолчанию называется 'flash', а на другой части никак не называется :)
  Захотелось изобразить один универсальный бэкап-скрипт, который одинаково хорошо сохранит все настройки и журналы любого из этих устройств на доступном в текущий момент накопителе.
  Скрипт необходимо запустить на устройстве, и далее он сам разберётся что, как и куда нужно сохранять...
По умолчанию в настройках скрипта задана глубина архива =180 дней, которая автоматически снижается при нехватке свободного места на доступном накопителе.
Попутно, при запуске скрипта в окне терминала можно наблюдать отчёт о работе.

Алгоритм работы скрипта:
 - определяется место для хранения данных. Приоритеты в порядке убывания: 1. внешний накопитель, 2. встроенный накопитель
 - генерится новое имя для файлов: 'Диск/ИмяРоутера_ТекущаяДата'
 - удаляются все файлы, старше глубины архива + подходящие под шаблон: 'Диск/ИмяРоутера_'
 - в случае, когда на накопителе осталось менее 4% свободного места: удаляются файлы младше глубины архива + подходящие под шаблон: 'Диск/ИмяРоутера_'
 - создаются и сохраняются на доступном накопителе следующие файлы: бэкап настроек, экспорт настроек, журнал устройства

  В скрипте предусмотрена возможность отключения автоматического определения места сохранения данных, для этого переменной 'autoDskSel' задается значение 'false', а переменной 'diskName' указывается актуальное имя накопителя (по умолчанию задано имя "flash").
Обычно скрипт запускается по расписанию один раз в сутки.

https://forummikrotik.ru/viewtopic.php?p=91135#p91135

Используете скрипт - отметьте это звездочкой, Вам не сложно, а мне приятно!

Features:
- automatically determines the data storage location,
- allows you to set the archive depth in days,
- looks after free space on the drive,
- saves a backup file, a settings file and a log file,
- file names is based on the device ID and date,
- works on RouterOS 6.xx and 7.xx
- no dependencies on other software modules
